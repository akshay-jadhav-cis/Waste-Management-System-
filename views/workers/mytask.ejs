<% layout('layouts/biolerplate') %>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">ğŸ“‹ My Assigned Tasks</h2>
    <a href="/workers/dashboard" class="btn btn-outline-secondary btn-sm">â† Back</a>
  </div>

  <% if(tasks.length === 0) { %>
    <div class="text-center py-5">
      <i class="bi bi-check2-circle text-success display-4"></i>
      <p class="text-muted mt-3">No tasks assigned yet. ğŸ‰</p>
    </div>
  <% } else { %>
    <div class="row g-4">
      <% tasks.forEach(task => { %>
        <div class="col-12 col-md-6 col-lg-4">
          <div class="card shadow-sm h-100 border-0 rounded-4 task-card">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-dark mb-2">
                <i class="bi bi-trash text-danger me-2"></i> <%= task.garbageType %> Waste
              </h5>
              <p><strong>ğŸ“ Address:</strong> <%= task.address %></p>
              <p><strong>ğŸ‘¤ User:</strong> <%= task.user.name %></p>
              <p><strong>ğŸ“Œ Status:</strong> 
                <span class="badge <%= task.status === 'Pending' ? 'bg-warning text-dark' : 'bg-success' %>">
                  <%= task.status %>
                </span>
              </p>

              <div class="mt-auto d-flex justify-content-between">
                <a href="/conversation/<%= task.user._id %>/<%= task.assignedTo %>" 
                   class="btn btn-primary btn-sm rounded-pill">
                  ğŸ’¬ Chat
                </a>

                <% if(task.status === "Pending") { %>
                  <form action="/employee/task/<%= task._id %>/done" method="POST">
                    <button type="submit" class="btn btn-outline-success btn-sm rounded-pill">
                      âœ… Mark Done
                    </button>
                  </form>
                <% } else { %>
                  <button class="btn btn-success btn-sm rounded-pill" disabled>
                    âœ” Completed
                  </button>
                <% } %>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<style>
  .task-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .task-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
  }
</style>
