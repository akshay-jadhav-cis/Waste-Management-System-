<% layout("./layouts/biolerplate") %>
<body class="bg-light">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg rounded-3 border-0">
          <div class="card-body p-4">
            <h3 class="text-center mb-4 text-primary fw-bold">
              Garbage Complaint Form
            </h3>

            <form action="<%= adminId ? '/complaints/admin/add' : '/complaints/user/add' %>" 
                  method="POST" 
                  enctype="multipart/form-data" 
                  class="needs-validation" 
                  novalidate>
              <div class="mb-3">
                <label for="garbageType" class="form-label fw-semibold">Garbage Type</label>
                <select name="Garbage[garbageType]" id="garbageType" class="form-select" required>
                  <option value="">-- Select Type --</option>
                  <option value="dry">Dry</option>
                  <option value="water">Water</option>
                  <option value="mix">Mix</option>
                </select>
                <div class="invalid-feedback">Please select a garbage type.</div>
              </div>

              <!-- Description -->
              <div class="mb-3">
                <label for="Description" class="form-label fw-semibold">Description</label>
                <textarea rows="4" class="form-control" name="Garbage[description]" placeholder="Info about garbage" id="Description" required></textarea>
                <div class="invalid-feedback">Please provide a description.</div>
              </div>

              <!-- Image Upload -->
              <div class="mb-3">
                <label for="images" class="form-label fw-semibold">Upload Images</label>
                <input type="file" class="form-control" name="Garbage[image]" id="images" accept="image/*" multiple required>
                <div class="invalid-feedback">Please upload at least one image.</div>

                <!-- Preview container -->
                <div id="previewContainer" class="mt-2 d-flex flex-wrap gap-2"></div>
              </div>

              <!-- Location -->
              <div class="mb-3">
                <label for="Address" class="form-label fw-semibold">Location</label>
                <input type="text" class="form-control" name="Garbage[address]" id="Address" placeholder="Enter location" required>
                <div class="invalid-feedback">Please enter the location.</div>
              </div>

              <!-- Submit -->
              <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-lg">Submit Complaint</button>
              </div>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image preview script -->
  <script>
    const imagesInput = document.getElementById('images');
    const previewContainer = document.getElementById('previewContainer');

    imagesInput.addEventListener('change', function() {
      previewContainer.innerHTML = ''; // Clear previous previews

      Array.from(this.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.maxWidth = '100px';
          img.style.height = 'auto';
          img.classList.add('img-thumbnail');
          previewContainer.appendChild(img);
        }
        reader.readAsDataURL(file);
      });
    });
  </script>
</body>
